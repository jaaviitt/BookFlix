<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Command Center - BookFlix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <link th:href="@{/css/styles.css}" rel="stylesheet">
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
</head>
<body style="background-color: #141414;">

<div class="dashboard-header">
    <div class="d-flex align-items-center">
        <i class="bi bi-shield-lock-fill text-danger fs-3 me-3"></i>
        <h1 class="dashboard-title">Admin Center</h1>
    </div>
    <a href="/" class="btn btn-outline-light btn-sm">Ir a la Web</a>
</div>

<div class="container-fluid px-5 py-4">

    <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="pills-users-tab" data-bs-toggle="pill" data-bs-target="#pills-users" type="button">
                ðŸ‘¥ Usuarios
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="pills-books-tab" data-bs-toggle="pill" data-bs-target="#pills-books" type="button">
                ðŸ“š Libros
            </button>
        </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">

        <div class="tab-pane fade show active" id="pills-users">
            <div class="dashboard-card">
                <div class="card-header-custom">
                    <h3 class="card-title-text">Base de Datos de Usuarios</h3>
                    <span class="badge bg-danger" th:text="${usuarios.size()} + ' Registrados'"></span>
                </div>

                <div class="table-responsive">
                    <table class="table-admin">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="usuario : ${usuarios}">
                            <td class="text-muted" th:text="'#'+${usuario.id}">1</td>
                            <td>
                                <div class="user-wrapper">
                                    <div class="user-avatar" th:text="${#strings.substring(usuario.username,0,1).toUpperCase()}">A</div>
                                    <span th:text="${usuario.username}">Nombre</span>
                                </div>
                            </td>
                            <td th:text="${usuario.email}">email@test.com</td>
                            <td>
                                <span th:each="rol : ${usuario.roles}"
                                      th:class="'badge-role me-1 ' + (${rol == 'ROLE_ADMIN'} ? 'admin' : '')"
                                      th:text="${rol.replace('ROLE_', '')}">ADMIN</span>
                            </td>

                            <td class="text-end">
                                <div th:if="${usuario.username == 'admin'}">
                                    <span class="badge bg-warning text-dark fw-bold">
                                        <i class="bi bi-crown-fill"></i> SUPREMO
                                    </span>
                                </div>

                                <div th:unless="${usuario.username == 'admin'}" class="actions-grid">

                                    <form th:action="@{/admin/usuario/{id}/cambiar-rol(id=${usuario.id})}" method="post">
                                        <button class="action-btn edit" title="Cambiar Rol">
                                            <i class="bi bi-person-gear"></i>
                                        </button>
                                    </form>

                                    <form th:action="@{/admin/usuario/{id}/eliminar(id=${usuario.id})}" method="post"
                                          onsubmit="return confirm('Â¿Eliminar usuario?');">
                                        <button class="action-btn delete" title="Eliminar">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>

                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="pills-books">
            <div class="dashboard-card">
                <div class="card-header-custom">
                    <h3 class="card-title-text">CatÃ¡logo de Libros</h3>
                    <a href="/admin/nuevo-libro" class="btn btn-sm btn-danger fw-bold">+ NUEVO LIBRO</a>
                </div>

                <div class="table-responsive">
                    <table class="table-admin">
                        <thead>
                        <tr>
                            <th>Portada</th>
                            <th>TÃ­tulo</th>
                            <th>Autor</th>
                            <th>GÃ©neros</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="libro : ${libros}">
                            <td>
                                <img th:src="${libro.imagenUrl != null ? libro.imagenUrl : 'https://via.placeholder.com/40'}"
                                     style="height: 40px; border-radius: 4px;">
                            </td>
                            <td class="fw-bold" th:text="${libro.titulo}">TÃ­tulo</td>
                            <td th:text="${libro.autor}">Autor</td>
                            <td>
                                <span th:each="gen : ${libro.generos}" class="badge bg-secondary me-1"
                                      style="font-size: 0.7rem;" th:text="${gen}">Gen</span>
                            </td>
                            <td class="text-end">
                                <div class="actions-grid">
                                    <a th:href="@{/admin/libro/{id}/editar(id=${libro.id})}" class="action-btn edit" title="Editar Libro">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <form th:action="@{/admin/libro/{id}/eliminar(id=${libro.id})}" method="post"
                                          onsubmit="return confirm('Â¿Borrar libro?');">
                                        <button class="action-btn delete" title="Eliminar">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>